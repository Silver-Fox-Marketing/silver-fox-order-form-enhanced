<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MinisForum Database Control - Silver Fox Marketing</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vin_log_update.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-section">
                    <img src="{{ url_for('static', filename='images/LS_MAIN-PRIMARY.svg') }}" alt="Silver Fox Marketing" class="header-logo">
                    <div class="title-section">
                        <h1 class="app-title">MinisForum Database Control</h1>
                        <span class="company-name">Silver Fox Marketing</span>
                    </div>
                </div>
                <div class="status-section">
                    <div class="status-indicator" id="systemStatus">
                        <i class="fas fa-circle status-icon"></i>
                        <span class="status-text">System Ready</span>
                    </div>
                    <div class="last-scrape" id="lastScrape">
                        Last Scrape: Never
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Content Area - Full Width -->
            <div class="content-area">
                <!-- Tab Navigation -->
                <nav class="tab-navigation">
                    <button class="tab-button active" data-tab="scraper">
                        <i class="fas fa-spider"></i>
                        Scraper Control
                    </button>
                    <button class="tab-button" data-tab="queue-management">
                        <i class="fas fa-tasks"></i>
                        Order Queue
                    </button>
                    <button class="tab-button" data-tab="data-search">
                        <i class="fas fa-search"></i>
                        Data
                    </button>
                    <button class="tab-button" data-tab="system-status">
                        <i class="fas fa-chart-line"></i>
                        System Status
                    </button>
                    <button class="tab-button" data-tab="dealership-settings">
                        <i class="fas fa-cog"></i>
                        Dealership Settings
                    </button>
                    <button class="tab-button" onclick="window.open('/stress-test', '_blank')">
                        <i class="fas fa-vial"></i>
                        System Tests
                    </button>
                    <button class="tab-button" onclick="window.open('/websocket-test', '_blank')" title="Test WebSocket Connection">
                        <i class="fas fa-wifi"></i>
                        WebSocket Test
                    </button>
                </nav>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Scraper Tab -->
                    <div class="tab-panel active" id="scraper-panel">
                        <div class="panel-header">
                            <h2>Scraper Control Center</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" id="selectDealershipsBtn">
                                    <i class="fas fa-list-check"></i>
                                    Select Dealerships
                                </button>
                                <button class="btn btn-secondary" id="scheduleBtn">
                                    <i class="fas fa-clock"></i>
                                    Schedule
                                </button>
                                <button class="btn btn-primary" id="startScrapeBtn">
                                    <i class="fas fa-play"></i>
                                    Start Scrape (All)
                                </button>
                                <button class="btn btn-secondary" id="testWebSocketBtn" title="Test WebSocket Connection">
                                    <i class="fas fa-wifi"></i>
                                    Test Connection
                                </button>
                            </div>
                        </div>
                        

                        <!-- Live Scraper Console (moved from System Status tab) -->
                        <div class="system-console">
                            <div class="console-header">
                                <h3>
                                    <i class="fas fa-terminal"></i>
                                    Live Scraper Console
                                </h3>
                                
                                <!-- Progress Indicators (new) -->
                                <div class="progress-indicators">
                                    <div class="indicator">
                                        <i class="fas fa-building"></i>
                                        <span class="indicator-value" id="dealershipsProcessed">0</span>
                                    </div>
                                    <div class="indicator">
                                        <i class="fas fa-car"></i>
                                        <span class="indicator-value" id="vehiclesProcessed">0</span>
                                    </div>
                                    <div class="indicator">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <span class="indicator-value" id="errorsCount">0</span>
                                    </div>
                                </div>
                                
                                <div class="console-controls">
                                    <button class="terminal-clear" onclick="app.clearScraperConsole()">
                                        <i class="fas fa-broom"></i>
                                        Clear
                                    </button>
                                    <button class="terminal-clear" onclick="app.pauseScraperConsole()">
                                        <i class="fas fa-pause" id="pauseIcon"></i>
                                        <span id="pauseText">Pause</span>
                                    </button>
                                </div>
                            </div>
                            <div class="console-content" id="scraperConsoleOutput">
                                <div class="terminal-line">
                                    <span class="timestamp">[00:00:00]</span>
                                    <span class="message">Scraper console ready - waiting for scraper activity...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Dealership Grid - Removed in favor of dropdown selection -->
                        <!-- <div class="dealership-grid" id="dealershipGrid">
                            Dealerships will be loaded dynamically
                        </div> -->

                        <!-- Scraper Status -->
                        <div class="scraper-status" id="scraperStatus" style="display: none;">
                            <div class="status-header">
                                <h3>Scraper Progress</h3>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFill"></div>
                                </div>
                            </div>
                            <div class="status-details" id="statusDetails">
                                <!-- Progress details will be shown here -->
                            </div>
                            
                            <!-- Real-time Scraper Console -->
                            <div class="scraper-console">
                                <div class="console-header">
                                    <h4>
                                        <i class="fas fa-terminal"></i>
                                        Real-time Scraper Output
                                    </h4>
                                    <button class="btn btn-secondary btn-sm" id="clearScraperConsole">
                                        <i class="fas fa-trash"></i>
                                        Clear
                                    </button>
                                </div>
                                <div class="console-content" id="scraperConsoleOutput">
                                    <div class="terminal-line">
                                        <span class="timestamp">[Ready]</span>
                                        <span class="message">Scraper console initialized</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Search Tab -->
                    <div class="tab-panel" id="data-search-panel">
                        <div class="panel-header">
                            <h2>Data Management</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" id="exportSearchResults" style="display: none;">
                                    <i class="fas fa-download"></i>
                                    Export Results
                                </button>
                                <button class="btn btn-primary" id="refreshDataSearch">
                                    <i class="fas fa-sync"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sub-tab Navigation -->
                        <div class="sub-tab-navigation">
                            <button class="sub-tab-button active" data-subtab="scraper-view">
                                <i class="fas fa-spider"></i>
                                Scraper View
                            </button>
                            <button class="sub-tab-button" data-subtab="vin-history">
                                <i class="fas fa-history"></i>
                                VIN History Logs
                            </button>
                        </div>
                        
                        <!-- Sub-tab Panels -->
                        <div class="sub-tab-panels">
                            <!-- Scraper View Sub-panel -->
                            <div class="sub-tab-panel active" id="scraper-view-panel">
                                <!-- CSV Import Section -->
                                <div class="csv-import-section">
                                    <div class="import-header">
                                        <h3>
                                            <i class="fas fa-file-csv"></i>
                                            Import Scraper Data
                                        </h3>
                                        <div class="import-actions">
                                            <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                                            <button class="btn btn-primary" id="selectCsvBtn">
                                                <i class="fas fa-upload"></i>
                                                Select CSV File
                                            </button>
                                            <button class="btn btn-secondary" id="importCsvBtn" disabled>
                                                <i class="fas fa-download"></i>
                                                Import Data
                                            </button>
                                        </div>
                                    </div>
                                    <div class="import-status" id="importStatus" style="display: none;">
                                        <div class="status-message" id="importStatusMessage"></div>
                                        <div class="progress-bar" id="importProgressBar" style="display: none;">
                                            <div class="progress-fill" id="importProgressFill"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Scraper History Table -->
                                <div class="scraper-history-section">
                                    <div class="history-header">
                                        <h3>
                                            <i class="fas fa-history"></i>
                                            Scraper Import History
                                        </h3>
                                        <button class="btn btn-secondary" id="refreshScraperHistory">
                                            <i class="fas fa-sync"></i>
                                            Refresh
                                        </button>
                                    </div>
                                    
                                    <div class="scraper-table-container" id="scraperTableContainer">
                                        <div class="loading">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            Loading scraper history...
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- VIN History Sub-panel -->
                            <div class="sub-tab-panel" id="vin-history-panel" style="display: none;">
                                <div class="vin-history-interface">
                                    <!-- VIN History Search Bar -->
                                    <div class="dealership-search-container">
                                        <input type="text" 
                                               class="search-input" 
                                               id="dealershipSearchInput" 
                                               placeholder="Search dealerships by name...">
                                        <button class="search-btn" id="searchDealershipsBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Dealership Cards Grid -->
                                    <div class="dealership-cards-grid" id="dealershipCardsGrid">
                                        <div class="loading">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            Loading dealership VIN logs...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- System Status Tab -->
                    <div class="tab-panel" id="system-status-panel">
                        <div class="panel-header">
                            <h2>Silver Fox System Status</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" onclick="window.open('/test', '_blank')">
                                    <i class="fas fa-external-link-alt"></i>
                                    Detailed Status
                                </button>
                                <button class="btn btn-primary" id="refreshSystemStatus">
                                    <i class="fas fa-sync"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="system-metrics" id="systemMetrics">
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-spider"></i>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Active Scrapers</h3>
                                        <div class="metric-value" id="activeScrapers">Loading...</div>
                                        <div class="metric-label">Real-time scrapers ready</div>
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Database Health</h3>
                                        <div class="metric-value" id="databaseHealth">Loading...</div>
                                        <div class="metric-label">Connection performance</div>
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-clipboard-list"></i>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Order Processing</h3>
                                        <div class="metric-value" id="orderProcessingStatus">Loading...</div>
                                        <div class="metric-label">CAO & List orders ready</div>
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Vehicle Inventory</h3>
                                        <div class="metric-value" id="vehicleCount">Loading...</div>
                                        <div class="metric-label">Total vehicles in database</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="system-actions">
                                <h3>Quick Actions</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="app.switchTab('queue-management')">
                                        <i class="fas fa-tasks"></i>
                                        Open Queue Manager
                                    </button>
                                    <button class="btn btn-secondary" onclick="window.open('/stress-test', '_blank')">
                                        <i class="fas fa-vial"></i>
                                        Run System Tests
                                    </button>
                                    <button class="btn btn-secondary" id="exportSystemReport">
                                        <i class="fas fa-download"></i>
                                        Export Report
                                    </button>
                                </div>
                            </div>
                            
                            <!-- System Console - Landscape Layout -->
                            <div class="system-console">
                                <div class="console-header">
                                    <h3>
                                        <i class="fas fa-terminal"></i>
                                        System Output Console
                                    </h3>
                                    <button class="btn btn-secondary btn-sm" id="clearTerminalStatus">
                                        <i class="fas fa-trash"></i>
                                        Clear
                                    </button>
                                </div>
                                <div class="console-content" id="terminalOutputStatus">
                                    <div class="terminal-line">
                                        <span class="timestamp">[Starting]</span>
                                        <span class="message">System initialized and ready</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Active Scrapers Status -->
                        <div class="active-scrapers-panel">
                            <h3>Active Scrapers</h3>
                            <div class="active-scrapers-list" id="activeScrapersList">
                                <div class="empty-state">
                                    <i class="fas fa-robot"></i>
                                    <p>No active scrapers</p>
                                    <p class="help-text">Start a scraper from the dealership grid above to see real-time progress</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dealership Settings Tab -->
                    <div class="tab-panel" id="dealership-settings-panel">
                        <div class="panel-header">
                            <h2>Dealership Settings</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" id="refreshDealershipSettings">
                                    <i class="fas fa-sync"></i>
                                    Refresh
                                </button>
                                <button class="btn btn-primary" id="saveDealershipSettings">
                                    <i class="fas fa-save"></i>
                                    Save All Changes
                                </button>
                            </div>
                        </div>
                        
                        <div class="dealership-settings-container">
                            <div class="settings-grid" id="dealershipSettingsGrid">
                                <div class="loading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Loading dealership settings...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Queue Management Tab -->
                    <div class="tab-panel" id="queue-management-panel">
                        <div class="panel-header">
                            <h2>Order Queue Management</h2>
                            <div class="control-buttons">
                                <button class="btn btn-secondary" id="clearQueueBtn">
                                    <i class="fas fa-trash"></i>
                                    Clear Queue
                                </button>
                                <button class="btn btn-primary" id="refreshQueueBtn">
                                    <i class="fas fa-sync"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="queue-layout">
                            <!-- Left Panel - Selection Interface -->
                            <div class="selection-panel">
                                <!-- Day Buttons -->
                                <div class="day-selection">
                                    <h3>Scheduled Days</h3>
                                    <div class="day-buttons">
                                        <button class="day-btn" data-day="monday">
                                            <i class="fas fa-calendar-day"></i>
                                            Monday
                                        </button>
                                        <button class="day-btn" data-day="tuesday">
                                            <i class="fas fa-calendar-day"></i>
                                            Tuesday
                                        </button>
                                        <button class="day-btn" data-day="wednesday">
                                            <i class="fas fa-calendar-day"></i>
                                            Wednesday
                                        </button>
                                        <button class="day-btn" data-day="thursday">
                                            <i class="fas fa-calendar-day"></i>
                                            Thursday
                                        </button>
                                        <button class="day-btn" data-day="friday">
                                            <i class="fas fa-calendar-day"></i>
                                            Friday
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Individual Dealerships -->
                                <div class="dealership-selection">
                                    <h3>Individual Dealerships</h3>
                                    <div class="dealership-list" id="dealershipList">
                                        <!-- Will be populated dynamically -->
                                        <div class="loading">Loading dealerships...</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Panel - Processing Queue -->
                            <div class="queue-panel">
                                <h3>Processing Queue</h3>
                                <div class="queue-items" id="queueItems">
                                    <div class="empty-queue">
                                        <i class="fas fa-clipboard-list"></i>
                                        <p>No dealerships in queue</p>
                                        <p class="help-text">Select dealerships or day buttons to add to queue</p>
                                    </div>
                                </div>
                                
                                <div class="queue-actions">
                                    <!-- Testing Mode Toggle -->
                                    <div class="testing-mode-toggle" style="margin-bottom: 1rem; padding: 0.75rem; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
                                        <label style="display: flex; align-items: center; cursor: pointer; margin: 0;">
                                            <input type="checkbox" id="queueTestingMode" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                                            <span style="font-weight: 500; color: #856404;">
                                                <i class="fas fa-flask" style="margin-right: 5px;"></i>
                                                Testing Mode - Skip VIN History Logging
                                            </span>
                                        </label>
                                        <p style="margin: 8px 0 0 28px; color: #856404; font-size: 12px; line-height: 1.3;">
                                            When enabled, processed VINs will NOT be added to dealership VIN histories. Use for testing to avoid affecting future CAO comparisons.
                                        </p>
                                    </div>
                                    
                                    <button class="btn btn-primary btn-large" id="processQueueBtn" disabled>
                                        <i class="fas fa-play"></i>
                                        Process Queue
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <img src="{{ url_for('static', filename='images/Asset_67.svg') }}" alt="Silver Fox Asset" class="footer-logo">
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Dealership Settings Modal -->
    <div class="modal" id="dealershipModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Dealership Settings</h3>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="dealershipForm">
                    <div class="form-group">
                        <label>Vehicle Types to Include:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="vehicle_types" value="new" checked>
                                <span class="checkmark"></span>
                                New Vehicles
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="vehicle_types" value="po" checked>
                                <span class="checkmark"></span>
                                Pre-Owned Vehicles
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="vehicle_types" value="cpo" checked>
                                <span class="checkmark"></span>
                                Certified Pre-Owned
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="minPrice">Minimum Price:</label>
                        <input type="number" id="minPrice" name="min_price" min="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="maxPrice">Maximum Price:</label>
                        <input type="number" id="maxPrice" name="max_price" min="0" placeholder="No limit">
                    </div>
                    <div class="form-group">
                        <label for="minYear">Minimum Year:</label>
                        <input type="number" id="minYear" name="min_year" min="1900" max="2030" placeholder="Any year">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSettings">Cancel</button>
                <button class="btn btn-primary" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Vehicle History Modal -->
    <div class="modal" id="vehicleHistoryModal">
        <div class="modal-content vehicle-history-modal">
            <div class="modal-header">
                <h3 id="vehicleHistoryTitle">Vehicle History</h3>
                <button class="modal-close" id="closeVehicleHistoryModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Vehicle Summary Section -->
                <div class="vehicle-summary" id="vehicleSummary">
                    <div class="vehicle-info">
                        <div class="info-group">
                            <label>VIN:</label>
                            <span id="modalVin" class="vin-display">-</span>
                        </div>
                        <div class="info-group">
                            <label>Vehicle:</label>
                            <span id="modalVehicle">-</span>
                        </div>
                        <div class="info-group">
                            <label>Total Scrapes:</label>
                            <span id="modalTotalScrapes" class="scrape-badge">-</span>
                        </div>
                        <div class="info-group">
                            <label>Current Location:</label>
                            <span id="modalCurrentLocation">-</span>
                        </div>
                    </div>
                </div>
                
                <!-- History Timeline -->
                <div class="history-section">
                    <h4>Complete Vehicle History</h4>
                    <div class="history-timeline" id="historyTimeline">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i>
                            Loading vehicle history...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Scraper Schedule</h3>
                <button class="modal-close" id="closeScheduleModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label for="scheduleTime">Daily Scrape Time:</label>
                        <input type="time" id="scheduleTime" name="schedule_time" value="02:00">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableSchedule" name="enable_schedule">
                            <span class="checkmark"></span>
                            Enable Automatic Scheduling
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSchedule">Cancel</button>
                <button class="btn btn-primary" id="saveSchedule">Save Schedule</button>
            </div>
        </div>
    </div>

    <!-- Dealership Selection Modal -->
    <div class="modal" id="dealershipSelectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Dealerships to Scrape</h3>
                <button class="modal-close" id="closeDealershipSelectionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="selection-actions">
                    <button class="btn btn-secondary btn-sm" id="selectAllBtnModal">Select All</button>
                    <button class="btn btn-secondary btn-sm" id="selectNoneBtnModal">Select None</button>
                </div>
                <div class="dealership-checkbox-grid" id="dealershipCheckboxGridModal">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDealershipSelection">Cancel</button>
                <button class="btn btn-primary" id="saveDealershipSelection">Start Selected Scrapers</button>
            </div>
        </div>
    </div>

    <!-- VIN Log Modal -->
    <div class="modal" id="vinLogModal">
        <div class="modal-content vin-log-modal">
            <div class="modal-header">
                <h3 id="vinLogModalTitle">VIN History Log</h3>
                <button class="modal-close" id="closeVinLogModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- VIN Log Stats -->
                <div class="vin-log-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="modalTotalVins">0</div>
                        <div class="stat-label">Total VINs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="modalOrderNumbers">0</div>
                        <div class="stat-label">Unique Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="modalDateRange">--</div>
                        <div class="stat-label">Date Range</div>
                    </div>
                </div>
                
                <!-- VIN Log Search -->
                <div class="vin-log-search">
                    <input type="text" id="vinLogSearch" placeholder="Search VINs..." class="search-input">
                    <button class="search-btn" id="vinLogSearchBtn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <!-- VIN Log Table -->
                <div class="vin-log-table-container" id="vinLogTableContainer">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                        Loading VIN history...
                    </div>
                </div>
                
                <!-- Pagination -->
                <div class="pagination" id="vinLogPagination" style="display: none;">
                    <button class="btn btn-secondary" id="vinLogPrevBtn" disabled>
                        <i class="fas fa-chevron-left"></i>
                        Previous
                    </button>
                    <span class="page-info" id="vinLogPageInfo">Page 1 of 1</span>
                    <button class="btn btn-secondary" id="vinLogNextBtn" disabled>
                        Next
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="exportVinLogData">
                    <i class="fas fa-download"></i>
                    Export Data
                </button>
                <button class="btn btn-warning" id="updateVinLogBtn">
                    <i class="fas fa-upload"></i>
                    Update VIN Log
                </button>
                <button class="btn btn-primary" id="closeVinLogModalBtn">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- VIN Log Update Modal -->
    <div class="modal" id="vinLogUpdateModal">
        <div class="modal-content vin-log-update-modal">
            <div class="modal-header">
                <h3 id="vinLogUpdateTitle">Update VIN Log</h3>
                <button class="modal-close" id="closeVinLogUpdateModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="update-info">
                    <p><strong>Import Order History CSV</strong></p>
                    <p>Upload a CSV file with VIN and order number data to update the <span id="updateDealershipName">dealership</span> VIN log.</p>
                    
                    <div class="csv-format-info">
                        <h4><i class="fas fa-info-circle"></i> Required CSV Format:</h4>
                        <div class="format-example">
                            <code>VIN,ORDER_NUMBER,ORDER_DATE</code><br>
                            <code>1HGBH41JXMN109186,SF24001,2024-01-15</code><br>
                            <code>2FMDK3GC4DBA54321,SF24002,2024-01-16</code>
                        </div>
                        <ul class="format-requirements">
                            <li><strong>VIN:</strong> 17-character vehicle identification number</li>
                            <li><strong>ORDER_NUMBER:</strong> Unique order identifier</li>
                            <li><strong>ORDER_DATE:</strong> Date in YYYY-MM-DD format (optional)</li>
                        </ul>
                    </div>
                </div>
                
                <!-- File Upload -->
                <div class="file-upload-section">
                    <div class="file-upload-area" id="vinLogFileUpload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to select CSV file or drag and drop</p>
                        <input type="file" id="vinLogFileInput" accept=".csv" style="display: none;">
                    </div>
                    <div class="file-info" id="vinLogFileInfo" style="display: none;">
                        <i class="fas fa-file-csv"></i>
                        <span id="vinLogFileName">No file selected</span>
                        <button class="remove-file" id="removeVinLogFile">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Import Options -->
                <div class="import-options">
                    <div class="option-group">
                        <input type="checkbox" id="skipDuplicates" checked>
                        <label for="skipDuplicates">Skip duplicate VINs (recommended)</label>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" id="updateExisting">
                        <label for="updateExisting">Update existing VIN records with new order numbers</label>
                    </div>
                </div>
                
                <!-- Progress Section -->
                <div class="import-progress" id="vinLogImportProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="vinLogProgressFill"></div>
                    </div>
                    <div class="progress-text" id="vinLogProgressText">Preparing import...</div>
                </div>
                
                <!-- Results Section -->
                <div class="import-results" id="vinLogImportResults" style="display: none;">
                    <h4>Import Results</h4>
                    <div class="results-stats">
                        <div class="result-stat">
                            <span class="stat-label">Processed:</span>
                            <span class="stat-value" id="processedCount">0</span>
                        </div>
                        <div class="result-stat">
                            <span class="stat-label">Added:</span>
                            <span class="stat-value success" id="addedCount">0</span>
                        </div>
                        <div class="result-stat">
                            <span class="stat-label">Updated:</span>
                            <span class="stat-value info" id="updatedCount">0</span>
                        </div>
                        <div class="result-stat">
                            <span class="stat-label">Skipped:</span>
                            <span class="stat-value warning" id="skippedCount">0</span>
                        </div>
                        <div class="result-stat">
                            <span class="stat-label">Errors:</span>
                            <span class="stat-value error" id="errorCount">0</span>
                        </div>
                    </div>
                    <div class="results-log" id="resultsLog">
                        <h5>Details:</h5>
                        <div class="log-container" id="importLogContainer">
                            <!-- Log entries will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelVinLogUpdate">
                    Cancel
                </button>
                <button class="btn btn-primary" id="startVinLogImport" disabled>
                    <i class="fas fa-upload"></i>
                    Import CSV
                </button>
            </div>
        </div>
    </div>

    <!-- Import Dealerships Modal -->
    <div class="modal" id="importDealershipsModal">
        <div class="modal-content import-dealerships-modal">
            <div class="modal-header">
                <h3 id="importDealershipsTitle">Dealerships in Import</h3>
                <button class="modal-close" id="closeImportDealershipsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="dealerships-list" id="importDealershipsList">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        Loading dealerships...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scraper Data Modal -->
    <div class="modal" id="scraperDataModal">
        <div class="modal-content scraper-data-modal">
            <div class="modal-header">
                <h3 id="scraperDataModalTitle">Scraper Data</h3>
                <button class="modal-close" id="closeScraperDataModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Import Info -->
                <div class="import-info" id="importInfo">
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Import ID:</label>
                            <span id="modalImportId">-</span>
                        </div>
                        <div class="info-item">
                            <label>Import Date:</label>
                            <span id="modalImportDate">-</span>
                        </div>
                        <div class="info-item">
                            <label>Source:</label>
                            <span id="modalImportSource">-</span>
                        </div>
                        <div class="info-item">
                            <label>Total Vehicles:</label>
                            <span id="modalTotalVehicles">-</span>
                        </div>
                    </div>
                </div>
                
                <!-- Vehicle Search within Modal -->
                <div class="modal-search">
                    <!-- Dealership filter tag -->
                    <div class="filter-tags" id="scraperDataFilterTags" style="display: none;">
                        <span class="dealership-filter-tag" id="dealershipFilterTag">
                            Dealership: <span id="dealershipFilterName"></span>
                            <button onclick="app.clearDealershipFilter()" title="Clear filter">Ã—</button>
                        </span>
                    </div>
                    <div class="scraper-data-search-bar">
                        <input type="text" id="scraperDataSearch" placeholder="Search vehicles in this scrape..." class="search-input">
                        <button class="search-btn" id="scraperDataSearchBtn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Vehicle Data Table -->
                <div class="scraper-data-table-container" id="scraperDataTableContainer">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                        Loading vehicle data...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="exportScraperData">
                    <i class="fas fa-download"></i>
                    Export Data
                </button>
                <button class="btn btn-primary" id="closeScraperDataModalBtn">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>